<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quick introduction to generating counterfactual explanations using DiCE &mdash; DiCE 0.11 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Estimating local and global feature importance scores using DiCE" href="DiCE_feature_importances.html" />
    <link rel="prev" title="&lt;no title&gt;" href="nb_index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> DiCE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Diverse Counterfactual Explanations (DiCE) for ML</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notebooks:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quick introduction to generating counterfactual explanations using DiCE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Preliminaries:-Loading-a-dataset-and-a-ML-model-trained-over-it">Preliminaries: Loading a dataset and a ML model trained over it</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Loading-the-Adult-dataset">Loading the <code class="docutils literal notranslate"><span class="pre">Adult</span></code> dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Loading-the-ML-model">Loading the ML model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Generating-counterfactual-examples-using-DiCE">Generating counterfactual examples using DiCE</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Generating-feature-attributions-(local-and-global)-using-DiCE">Generating feature attributions (local and global) using DiCE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Local-feature-importance-scores">Local feature importance scores</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Global-feature-importance-scores">Global feature importance scores</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Working-with-deep-learning-models-(TensorFlow-and-PyTorch)">Working with deep learning models (TensorFlow and PyTorch)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Explaining-a-Tensorflow-model">Explaining a Tensorflow model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Explaining-a-Pytorch-model">Explaining a Pytorch model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#More-resources:-What’s-next?">More resources: What’s next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="DiCE_feature_importances.html">Estimating local and global feature importance scores using DiCE</a></li>
<li class="toctree-l1"><a class="reference internal" href="DiCE_multiclass_classification_and_regression.html">Generating counterfactuals for multi-class classification and regression models</a></li>
<li class="toctree-l1"><a class="reference internal" href="DiCE_multiclass_classification_and_regression.html#Regression">Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="DiCE_model_agnostic_CFs.html">Generating counterfactual explanations with any ML model</a></li>
<li class="toctree-l1"><a class="reference internal" href="DiCE_with_private_data.html">Generating counterfactual explanations without access to training data</a></li>
<li class="toctree-l1"><a class="reference internal" href="DiCE_with_advanced_options.html">Advanced options to customize Counterfactual Explanations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dice_ml.html">dice_ml package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DiCE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="nb_index.html">&lt;no title&gt;</a> &raquo;</li>
      <li>Quick introduction to generating counterfactual explanations using DiCE</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/DiCE_getting_started.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Quick-introduction-to-generating-counterfactual-explanations-using-DiCE">
<h1>Quick introduction to generating counterfactual explanations using DiCE<a class="headerlink" href="#Quick-introduction-to-generating-counterfactual-explanations-using-DiCE" title="Permalink to this heading"></a></h1>
<p>Exploring “what-if” scenarios is an important way to inspect a machine learning (ML) model. The DiCE library helps you to understand an ML model by generating “what-if” data points that lead to the desired model output. Formally, such “what-if” data points are known as <em>counterfactuals</em>, described by the following question: &gt; Given that the model’s output for input <span class="math notranslate nohighlight">\(x\)</span> is <span class="math notranslate nohighlight">\(y\)</span>, what would be the output if input <span class="math notranslate nohighlight">\(x\)</span> is changed to <span class="math notranslate nohighlight">\(x'\)</span>?</p>
<p>The answer to the above question can be obtained by simply inputting <span class="math notranslate nohighlight">\(x'\)</span> to the ML model. However, in many cases, we are interested in the reverse question: what changes to <span class="math notranslate nohighlight">\(x\)</span> would lead to a desired change in model’s output? When inspecting a classifier, for instance, we are often interested in knowing the changes to <span class="math notranslate nohighlight">\(x\)</span> that will lead to a desired predicted class. For a regressor, we may be interested in the changes to <span class="math notranslate nohighlight">\(x\)</span> that lead to a desired output range. Ideally,
these changes should be <em>proximal</em> to bring out the local decision logic of the classifier, <em>sparse</em> to highlight a limited set of features, and <em>diverse</em> to show the different ways in which the same outcome can be achieved. The DiCE library provides an easy interface to generate such counterfactual examples for any ML model.</p>
<p>In addition to proximity (minimal changes) and diversity, another important metric for counterfactual examples is their <strong>feasibility</strong>. If the changes in a counterfactual example are not feasible (e.g., outside the possible range of a particular feature), then the example is less useful. Specifying the possible ranges for continuous features (and possible values for categorical features) is one of the simplest forms of feasibility. DiCE allows you to customize the permitted values for features
through the <code class="docutils literal notranslate"><span class="pre">permitted_range</span></code> parameter. In general, feasibility is a complex concept based on whether the <a class="reference external" href="https://arxiv.org/abs/1912.03277">changes indicated by a counterfactual are feasible</a> for the individual, not just that certain values are feasible (e.g., 20 years may be a feasible value for Age feature, but changing a person’s age from 22 to 20 is not feasible). DiCE will support such constraints in a future release.</p>
<p>Counterfactual examples generated by DiCE are closely related to <strong>necessity</strong> and <strong>sufficiency</strong> conditions for causing a given model output. Necessity and sufficiency provide an intuitive way to explain a model’s output. Given an input <span class="math notranslate nohighlight">\(x\)</span> and the model output <span class="math notranslate nohighlight">\(y\)</span>, a feature value <span class="math notranslate nohighlight">\(x_i\)</span> is <em>necessary</em> for causing the model output <span class="math notranslate nohighlight">\(y\)</span> if changing <span class="math notranslate nohighlight">\(x_i\)</span> changes the model output, while keeping every other feature constant. Similarly, a feature value <span class="math notranslate nohighlight">\(x_i\)</span> is
<em>sufficient</em> for causing the model output <span class="math notranslate nohighlight">\(y\)</span> if it is impossible to change the model output while keeping <span class="math notranslate nohighlight">\(x_i\)</span> constant. DiCE allows inspecting necessity and sufficiency by setting the <code class="docutils literal notranslate"><span class="pre">features_to_vary</span></code> parameter. If <code class="docutils literal notranslate"><span class="pre">features_to_vary</span></code> is set to <span class="math notranslate nohighlight">\(x_i\)</span>, then the generated counterfactuals demonstrate the necessity of the feature. If <code class="docutils literal notranslate"><span class="pre">features_to_vary</span></code> is set to all features except <span class="math notranslate nohighlight">\(x_i\)</span>, then the absence of any counterfactuals demonstrates the sufficiency of the
feature. In practice, a single feature may be neither sufficient nor necessary—the formal definitions and the <code class="docutils literal notranslate"><span class="pre">features_to_vary</span></code> parameter translate easily to sets of features.</p>
<p>Finally, the counterfactuals for an input data point can be used to derive a <strong>local importance score</strong> for each feature. The local feature importance score ranks features by their frequency of being changed in the generated counterfactuals. Among all the features, necessary features are likely to be changed more often to generate proximal counterfactuals and therefore will receive a higher score. You can use <code class="docutils literal notranslate"><span class="pre">features_to_vary</span></code> and <code class="docutils literal notranslate"><span class="pre">permitted_range</span></code> parameteres to refine the search space for
the counterfactuals and consequently, the local importance score. Given a set of input points, the local importance score can be aggregated to provide a global importance score. Compared to explanation methods like LIME or SHAP, feature importance scores generated by DiCE tend to give importance to a larger number of features; more details are in this <a class="reference external" href="https://arxiv.org/abs/2011.04917">paper</a>.</p>
<p>To generate counterfactuals, DiCE implements two kinds of methods: model-agnostic and gradient-based.</p>
<ul class="simple">
<li><p><strong>Model-Agnostic</strong>: These methods apply to any black-box classifier or regressor. They are based on sampling nearby points to an input point, while optimizing a loss function based on proximity (and optionally, sparsity, diversity and feasibility). Use this class of methods for sklearn models. Currently supported methods are:</p>
<ul>
<li><p>Randomized Search</p></li>
<li><p>Genetic Search</p></li>
<li><p>KD Tree Search (for counterfactuals from a given training dataset)</p></li>
</ul>
</li>
<li><p><strong>Gradient-Based</strong>: These methods apply to differentiable models, such as those returned by deep learning libraries like tensorflow and pytorch. They are based on an explicit loss minimization based on proximity, diversity and feasibility. The method is described in this <a class="reference external" href="https://arxiv.org/abs/1905.07697">paper</a>.</p></li>
</ul>
<p><img alt="DiCE API" src="../_images/dice_getting_started_api.png" /></p>
<p>DiCE requires two inputs: a training dataset and a pre-trained ML model. When the training dataset is unknown (e.g., for privacy reasons), it can also work without access to the full dataset (see this <a class="reference internal" href="DiCE_with_private_data.html"><span class="doc">notebook</span></a> for an example). Below we show a simple example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Sklearn imports
from sklearn.compose import ColumnTransformer
from sklearn.model_selection import train_test_split
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import OneHotEncoder
from sklearn.ensemble import RandomForestClassifier

# DiCE imports
import dice_ml
from dice_ml.utils import helpers  # helper functions
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>%load_ext autoreload
%autoreload 2
</pre></div>
</div>
</div>
<section id="Preliminaries:-Loading-a-dataset-and-a-ML-model-trained-over-it">
<h2>Preliminaries: Loading a dataset and a ML model trained over it<a class="headerlink" href="#Preliminaries:-Loading-a-dataset-and-a-ML-model-trained-over-it" title="Permalink to this heading"></a></h2>
<section id="Loading-the-Adult-dataset">
<h3>Loading the <code class="docutils literal notranslate"><span class="pre">Adult</span></code> dataset<a class="headerlink" href="#Loading-the-Adult-dataset" title="Permalink to this heading"></a></h3>
<p>We use the “adult” income dataset from UCI Machine Learning Repository (<a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/adult">https://archive.ics.uci.edu/ml/datasets/adult</a>). For demonstration purposes, we transform the data as described in <strong>dice_ml.utils.helpers</strong> module.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dataset = helpers.load_adult_income_dataset()
</pre></div>
</div>
</div>
<p>This dataset has 8 features. The outcome is income which is binarized to 0 (low-income, &lt;=50K) or 1 (high-income, &gt;50K).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dataset.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>28</td>
      <td>Private</td>
      <td>Bachelors</td>
      <td>Single</td>
      <td>White-Collar</td>
      <td>White</td>
      <td>Female</td>
      <td>60</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>30</td>
      <td>Self-Employed</td>
      <td>Assoc</td>
      <td>Married</td>
      <td>Professional</td>
      <td>White</td>
      <td>Male</td>
      <td>65</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32</td>
      <td>Private</td>
      <td>Some-college</td>
      <td>Married</td>
      <td>White-Collar</td>
      <td>White</td>
      <td>Male</td>
      <td>50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20</td>
      <td>Private</td>
      <td>Some-college</td>
      <td>Single</td>
      <td>Service</td>
      <td>White</td>
      <td>Female</td>
      <td>35</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>41</td>
      <td>Self-Employed</td>
      <td>Some-college</td>
      <td>Married</td>
      <td>White-Collar</td>
      <td>White</td>
      <td>Male</td>
      <td>50</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># description of transformed features
adult_info = helpers.get_adult_data_info()
adult_info
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;age&#39;: &#39;age&#39;,
 &#39;workclass&#39;: &#39;type of industry (Government, Other/Unknown, Private, Self-Employed)&#39;,
 &#39;education&#39;: &#39;education level (Assoc, Bachelors, Doctorate, HS-grad, Masters, Prof-school, School, Some-college)&#39;,
 &#39;marital_status&#39;: &#39;marital status (Divorced, Married, Separated, Single, Widowed)&#39;,
 &#39;occupation&#39;: &#39;occupation (Blue-Collar, Other/Unknown, Professional, Sales, Service, White-Collar)&#39;,
 &#39;race&#39;: &#39;white or other race?&#39;,
 &#39;gender&#39;: &#39;male or female?&#39;,
 &#39;hours_per_week&#39;: &#39;total work hours per week&#39;,
 &#39;income&#39;: &#39;0 (&lt;=50K) vs 1 (&gt;50K)&#39;}
</pre></div></div>
</div>
<p>Split the dataset into train and test sets.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>target = dataset[&quot;income&quot;]
train_dataset, test_dataset, y_train, y_test = train_test_split(dataset,
                                                                target,
                                                                test_size=0.2,
                                                                random_state=0,
                                                                stratify=target)
x_train = train_dataset.drop(&#39;income&#39;, axis=1)
x_test = test_dataset.drop(&#39;income&#39;, axis=1)
</pre></div>
</div>
</div>
<p>Given the train dataset, we construct a data object for DiCE. Since continuous and discrete features have different ways of perturbation, we need to specify the names of the continuous features. DiCE also requires the name of the output variable that the ML model will predict.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Step 1: dice_ml.Data
d = dice_ml.Data(dataframe=train_dataset, continuous_features=[&#39;age&#39;, &#39;hours_per_week&#39;], outcome_name=&#39;income&#39;)
</pre></div>
</div>
</div>
</section>
<section id="Loading-the-ML-model">
<h3>Loading the ML model<a class="headerlink" href="#Loading-the-ML-model" title="Permalink to this heading"></a></h3>
<p>DiCE supports sklearn, tensorflow and pytorch models.</p>
<p>The variable <em>backend</em> below indicates the implementation type of DiCE we want to use. Four backends are supported: sklearn, TensorFlow 1.x with backend=‘TF1’, Tensorflow 2.x with backend=‘TF2’, and PyTorch with backend=‘PYT’.</p>
<p>Below we show use a trained classification model using sklearn.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>numerical = [&quot;age&quot;, &quot;hours_per_week&quot;]
categorical = x_train.columns.difference(numerical)

categorical_transformer = Pipeline(steps=[
    (&#39;onehot&#39;, OneHotEncoder(handle_unknown=&#39;ignore&#39;))])

transformations = ColumnTransformer(
    transformers=[
        (&#39;cat&#39;, categorical_transformer, categorical)])

# Append classifier to preprocessing pipeline.
# Now we have a full prediction pipeline.
clf = Pipeline(steps=[(&#39;preprocessor&#39;, transformations),
                      (&#39;classifier&#39;, RandomForestClassifier())])
model = clf.fit(x_train, y_train)
</pre></div>
</div>
</div>
</section>
</section>
<section id="Generating-counterfactual-examples-using-DiCE">
<h2>Generating counterfactual examples using DiCE<a class="headerlink" href="#Generating-counterfactual-examples-using-DiCE" title="Permalink to this heading"></a></h2>
<p>We now initialize the DiCE explainer, which needs a dataset and a model. DiCE provides local explanation for the model <em>m</em> and requires an query input whose outcome needs to be explained.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Using sklearn backend
m = dice_ml.Model(model=model, backend=&quot;sklearn&quot;)
# Using method=random for generating CFs
exp = dice_ml.Dice(d, m, method=&quot;random&quot;)
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">method</span></code> parameter specifies the explanation method. DiCE supports three methods for sklearn models: random sampling, genetic algorithm search, and kd-tree based generation.</p>
<p>The next code snippet shows how to generate and visualize counterfactuals. The first argument of the <code class="docutils literal notranslate"><span class="pre">generate_counterfactuals</span></code> method is the <em>query instances</em> on which counterfactuals are desired. This can be a dataframe with one or more rows.</p>
<p>Below we provide a sample input whose outcome is 0 (low-income) as per the ML model object <em>m</em>. Given the query input, we can now generate counterfactual explanations to show perturbed inputs from the original input where the ML model outputs class 1 (high-income). The last column shows the output of the classifier: <code class="docutils literal notranslate"><span class="pre">income-output</span></code> &gt;=0.5 is class 1 and <code class="docutils literal notranslate"><span class="pre">income-output</span></code>&lt;0.5 is class 0.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>e1 = exp.generate_counterfactuals(x_test[0:1], total_CFs=2, desired_class=&quot;opposite&quot;)
e1.visualize_as_dataframe(show_only_changes=True)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00,  3.99it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query instance (original outcome : 0)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>Private</td>
      <td>HS-grad</td>
      <td>Married</td>
      <td>Blue-Collar</td>
      <td>White</td>
      <td>Female</td>
      <td>38</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Diverse Counterfactual set (new outcome: 1)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-</td>
      <td>-</td>
      <td>Prof-school</td>
      <td>-</td>
      <td>White-Collar</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-</td>
      <td>Government</td>
      <td>-</td>
      <td>Single</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">show_only_changes</span></code> parameter highlights the changes from the query instance. If you would like to see the full feature values for the counterfactuals, set it to False.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>e1.visualize_as_dataframe(show_only_changes=False)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query instance (original outcome : 0)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>Private</td>
      <td>HS-grad</td>
      <td>Married</td>
      <td>Blue-Collar</td>
      <td>White</td>
      <td>Female</td>
      <td>38</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Diverse Counterfactual set (new outcome: 1)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>Private</td>
      <td>Prof-school</td>
      <td>Married</td>
      <td>White-Collar</td>
      <td>White</td>
      <td>Female</td>
      <td>38</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>29</td>
      <td>Government</td>
      <td>HS-grad</td>
      <td>Single</td>
      <td>Blue-Collar</td>
      <td>White</td>
      <td>Female</td>
      <td>38</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>That’s it! You can try generating counterfactual explanations for other examples using the same code. It is also possible to restrict the features to vary while generating the counterfactuals, and to specify permitted range of features within which the counterfactual should be generated.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Changing only age and education
e2 = exp.generate_counterfactuals(x_test[0:1],
                                  total_CFs=2,
                                  desired_class=&quot;opposite&quot;,
                                  features_to_vary=[&quot;education&quot;, &quot;occupation&quot;]
                                  )
e2.visualize_as_dataframe(show_only_changes=True)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00,  3.88it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query instance (original outcome : 0)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>Private</td>
      <td>HS-grad</td>
      <td>Married</td>
      <td>Blue-Collar</td>
      <td>White</td>
      <td>Female</td>
      <td>38</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Diverse Counterfactual set (new outcome: 1)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-</td>
      <td>-</td>
      <td>Prof-school</td>
      <td>-</td>
      <td>Professional</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-</td>
      <td>-</td>
      <td>Some-college</td>
      <td>-</td>
      <td>Professional</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Restricting age to be between [20,30] and Education to be either {&#39;Doctorate&#39;, &#39;Prof-school&#39;}.
e3 = exp.generate_counterfactuals(x_test[0:1],
                                  total_CFs=2,
                                  desired_class=&quot;opposite&quot;,
                                  permitted_range={&#39;age&#39;: [20, 30], &#39;education&#39;: [&#39;Doctorate&#39;, &#39;Prof-school&#39;]})
e3.visualize_as_dataframe(show_only_changes=True)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00,  3.68it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query instance (original outcome : 0)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>29</td>
      <td>Private</td>
      <td>HS-grad</td>
      <td>Married</td>
      <td>Blue-Collar</td>
      <td>White</td>
      <td>Female</td>
      <td>38</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Diverse Counterfactual set (new outcome: 1)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-</td>
      <td>-</td>
      <td>Prof-school</td>
      <td>-</td>
      <td>White-Collar</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-</td>
      <td>-</td>
      <td>Prof-school</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>28</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Generating-feature-attributions-(local-and-global)-using-DiCE">
<h2>Generating feature attributions (local and global) using DiCE<a class="headerlink" href="#Generating-feature-attributions-(local-and-global)-using-DiCE" title="Permalink to this heading"></a></h2>
<p>DiCE can generate feature importance scores using a summary of the counterfactuals generated. Intuitively, a feature that is changed more often when generating proximal counterfactuals for an input is locally important for causing the model’s prediction at the input. Formally, counterfactuals operationalize the <strong>necessity</strong> criterion for a model explanation: <em>is the feature value necessary for the given model output?</em></p>
<p>For more details, refer to the paper, <a class="reference external" href="https://arxiv.org/abs/2011.04917">Towards Unifying Feature Attribution and Counterfactual Explanations: Different Means to the Same End</a>.</p>
<section id="Local-feature-importance-scores">
<h3>Local feature importance scores<a class="headerlink" href="#Local-feature-importance-scores" title="Permalink to this heading"></a></h3>
<p>These scores are computed for a given query instance (input point) by summarizing a set of counterfactual examples around the point.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>query_instance = x_test[0:1]
imp = exp.local_feature_importance(query_instance, total_CFs=10)
print(imp.local_importance)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00&lt;00:00,  2.31it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;education&#39;: 0.9, &#39;occupation&#39;: 0.4, &#39;workclass&#39;: 0.2, &#39;gender&#39;: 0.2, &#39;age&#39;: 0.2, &#39;marital_status&#39;: 0.0, &#39;race&#39;: 0.0, &#39;hours_per_week&#39;: 0.0}]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">total_CFs</span></code> parameter denotes the number of counterfactuals that are used to create the local importance. More the better.</p>
</section>
<section id="Global-feature-importance-scores">
<h3>Global feature importance scores<a class="headerlink" href="#Global-feature-importance-scores" title="Permalink to this heading"></a></h3>
<p>A global importance score per feature can be estimated by aggregating the scores over individual inputs. The more the inputs, the better the estimate for global importance of a feature.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>query_instances = x_test[0:20]
imp = exp.global_feature_importance(query_instances)
print(imp.summary_importance)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███████████████████████████████████████████████████████████████████████████████████| 20/20 [00:08&lt;00:00,  2.25it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;education&#39;: 0.62, &#39;occupation&#39;: 0.295, &#39;marital_status&#39;: 0.29, &#39;workclass&#39;: 0.22, &#39;age&#39;: 0.205, &#39;hours_per_week&#39;: 0.205, &#39;race&#39;: 0.115, &#39;gender&#39;: 0.09}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
</section>
</section>
<section id="Working-with-deep-learning-models-(TensorFlow-and-PyTorch)">
<h2>Working with deep learning models (TensorFlow and PyTorch)<a class="headerlink" href="#Working-with-deep-learning-models-(TensorFlow-and-PyTorch)" title="Permalink to this heading"></a></h2>
<p>We now show examples of gradient-based methods with Tensorflow and Pytorch models. Since the gradient-based methods <em>optimize</em> the loss rather than simply sampling some points, they can be slower to generate counterfactuals. The loss is defined by three component: <strong>validity</strong> (does the CF have the desired model output), <strong>proximity</strong> (distance of CF from original point should be low), and <strong>diversity</strong> (multiple CFs should change different features). The DiCE loss formulation is described in
the paper, <a class="reference external" href="https://arxiv.org/abs/1905.07697">Explaining Machine Learning Classifiers through Diverse Counterfactual Explanations</a>.</p>
<p>Below, we use a pre-trained ML model which produces high accuracy comparable to other baselines. For convenience, we include the sample trained model with the DiCE package.</p>
<section id="Explaining-a-Tensorflow-model">
<h3>Explaining a Tensorflow model<a class="headerlink" href="#Explaining-a-Tensorflow-model" title="Permalink to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>backend = &#39;TF2&#39;  # needs tensorflow installed
ML_modelpath = helpers.get_adult_income_modelpath(backend=backend)
# Step 2: dice_ml.Model
m = dice_ml.Model(model_path=ML_modelpath, backend=backend, func=&quot;ohe-min-max&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-10-26 15:43:24.138021: I tensorflow/core/util/util.cc:169] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-10-26 15:43:24.207078: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libcudart.so.11.0&#39;; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory
2023-10-26 15:43:24.207103: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.
</pre></div></div>
</div>
<p>We want to note that the time required to find counterfactuals with Tensorflow 2.x’s eager style of execution is significantly greater than that with TensorFlow 1.x’s graph execution.</p>
<p>Based on the data object <em>d</em> and the model object <em>m</em>, we can now instantiate the DiCE class for generating explanations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Step 3: initiate DiCE
exp = dice_ml.Dice(d, m, method=&quot;gradient&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2023-10-26 15:43:28.626560: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libcuda.so.1&#39;; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory
2023-10-26 15:43:28.626614: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)
2023-10-26 15:43:28.626637: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (AMSHAR-X1): /proc/driver/nvidia/version does not exist
2023-10-26 15:43:28.627732: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F AVX512_VNNI FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre></div></div>
</div>
<p>Below we provide query instances from <code class="docutils literal notranslate"><span class="pre">x_test</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># generate counterfactuals
dice_exp = exp.generate_counterfactuals(x_test[1:2], total_CFs=4, desired_class=&quot;opposite&quot;)
# visualize the result, highlight only the changes
dice_exp.visualize_as_dataframe(show_only_changes=True)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Diverse Counterfactuals found! total time taken: 00 min 53 sec
Query instance (original outcome : 0.6710000038146973)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50.0</td>
      <td>Other/Unknown</td>
      <td>Some-college</td>
      <td>Married</td>
      <td>Other/Unknown</td>
      <td>White</td>
      <td>Male</td>
      <td>40.0</td>
      <td>0.671</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Diverse Counterfactual set (new outcome: 0.0)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>23.0</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>13.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17.0</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>Other</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-</td>
      <td>-</td>
      <td>School</td>
      <td>Single</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>62.0</td>
      <td>-</td>
      <td>-</td>
      <td>Divorced</td>
      <td>Blue-Collar</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The counterfactuals generated above are slightly different from those shown in <a class="reference external" href="https://arxiv.org/pdf/1905.07697.pdf">our paper</a>, where the loss convergence condition was made more conservative for rigorous experimentation. To replicate the results in the paper, add an argument <em>loss_converge_maxiter=2</em> (the default value is 1) in the <em>exp.generate_counterfactuals()</em> method above. For more info, see <em>generate_counterfactuals()</em> method in
<a class="reference external" href="https://github.com/interpretml/DiCE/blob/master/dice_ml/dice_interfaces/dice_tensorflow1.py">dice_ml.dice_interfaces.dice_tensorflow.py</a>.</p>
</section>
<section id="Explaining-a-Pytorch-model">
<h3>Explaining a Pytorch model<a class="headerlink" href="#Explaining-a-Pytorch-model" title="Permalink to this heading"></a></h3>
<p>Just change the backend variable to ‘PYT’ to use DiCE with PyTorch. Below, we use a pre-trained ML model in PyTorch which produces high accuracy comparable to other baselines. For convenience, we include the sample trained model with the DiCE package. Additionally, we need to provide a data transformer function that converts input dataframe into one-hot encoded/numeric format.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>backend = &#39;PYT&#39;  # needs pytorch installed
ML_modelpath = helpers.get_adult_income_modelpath(backend=backend)
m = dice_ml.Model(model_path=ML_modelpath, backend=backend,  func=&quot;ohe-min-max&quot;)
</pre></div>
</div>
</div>
<p>Instantiate the DiCE class with the new PyTorch model object <em>m</em>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>exp = dice_ml.Dice(d, m, method=&quot;gradient&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># generate counterfactuals
dice_exp = exp.generate_counterfactuals(x_test[1:3], total_CFs=4, desired_class=&quot;opposite&quot;)
# highlight only the changes
dice_exp.visualize_as_dataframe(show_only_changes=True)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|██████████████████████████████████████████▌                                          | 1/2 [00:04&lt;00:04,  4.54s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Diverse Counterfactuals found! total time taken: 00 min 04 sec
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:09&lt;00:00,  4.88s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Diverse Counterfactuals found! total time taken: 00 min 04 sec
Query instance (original outcome : 0.6179999709129333)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50</td>
      <td>Other/Unknown</td>
      <td>Some-college</td>
      <td>Married</td>
      <td>Other/Unknown</td>
      <td>White</td>
      <td>Male</td>
      <td>40</td>
      <td>0.618</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Diverse Counterfactual set (new outcome: 0.0)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>38</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>26</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>Blue-Collar</td>
      <td>-</td>
      <td>Female</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-</td>
      <td>Government</td>
      <td>School</td>
      <td>Single</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>70</td>
      <td>-</td>
      <td>-</td>
      <td>Divorced</td>
      <td>-</td>
      <td>Other</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query instance (original outcome : 0.9679999947547913)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50</td>
      <td>Private</td>
      <td>Bachelors</td>
      <td>Married</td>
      <td>Professional</td>
      <td>White</td>
      <td>Male</td>
      <td>40</td>
      <td>0.968</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Diverse Counterfactual set (new outcome: 0.0)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>35</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-</td>
      <td>-</td>
      <td>Some-college</td>
      <td>Separated</td>
      <td>Service</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>69</td>
      <td>-</td>
      <td>-</td>
      <td>Single</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-</td>
      <td>Other/Unknown</td>
      <td>School</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>Female</td>
      <td>-</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can also use method-agnostic explainers like “random” or “genetic”.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>m = dice_ml.Model(model_path=ML_modelpath, backend=backend, func=&quot;ohe-min-max&quot;)
exp = dice_ml.Dice(d, m, method=&quot;random&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># generate counterfactuals
dice_exp = exp.generate_counterfactuals(x_test[1:3], total_CFs=4, desired_class=&quot;opposite&quot;)
# highlight only the changes
dice_exp.visualize_as_dataframe(show_only_changes=True)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:00&lt;00:00,  2.32it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query instance (original outcome : 1)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50</td>
      <td>Other/Unknown</td>
      <td>Some-college</td>
      <td>Married</td>
      <td>Other/Unknown</td>
      <td>White</td>
      <td>Male</td>
      <td>40</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Diverse Counterfactual set (new outcome: 0)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>Widowed</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>22</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>28</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>29</td>
      <td>Private</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-</td>
      <td>-</td>
      <td>School</td>
      <td>Widowed</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query instance (original outcome : 1)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50</td>
      <td>Private</td>
      <td>Bachelors</td>
      <td>Married</td>
      <td>Professional</td>
      <td>White</td>
      <td>Male</td>
      <td>40</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Diverse Counterfactual set (new outcome: 0)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>workclass</th>
      <th>education</th>
      <th>marital_status</th>
      <th>occupation</th>
      <th>race</th>
      <th>gender</th>
      <th>hours_per_week</th>
      <th>income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>Separated</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>32</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>Separated</td>
      <td>-</td>
      <td>-</td>
      <td>Female</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-</td>
      <td>-</td>
      <td>School</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>Female</td>
      <td>-</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>Single</td>
      <td>-</td>
      <td>Other</td>
      <td>-</td>
      <td>-</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="More-resources:-What’s-next?">
<h2>More resources: What’s next?<a class="headerlink" href="#More-resources:-What’s-next?" title="Permalink to this heading"></a></h2>
<p>DiCE has multiple configurable options and support for different kinds of models. Follow these notebooks to learn more.</p>
<ol class="arabic simple">
<li><p>You can constrain the features to vary, weigh the relative importance of different features for computing distance, or specify permitted ranges for each feature. Check out the <a class="reference internal" href="DiCE_with_advanced_options.html"><span class="doc">Customizing Counterfactuals Notebook</span></a>.</p></li>
<li><p>You can use it for multi-class classification or regression models. <a class="reference internal" href="DiCE_multiclass_classification_and_regression.html"><span class="doc">Counterfactuals for Multi-class Classification and Regression Models Notebook</span></a>.</p></li>
<li><p>Explore the different model-agnostic explanation methods in DiCE. <a class="reference internal" href="DiCE_model_agnostic_CFs.html"><span class="doc">Model-agnostic Counterfactual Generation Methods</span></a>.</p></li>
<li><p>You can generate CFs even without access to training data (e.g., for privacy-sensitive data). <a class="reference internal" href="DiCE_with_private_data.html"><span class="doc">DiCE with Private Data Notebook</span></a>.</p></li>
<li><p>Feasibility of counterfactuals is an important consideration. You can try out this VAE-based method that adds a CF likelihood term to the loss. <a class="reference internal" href="DiCE_getting_started_feasible.html"><span class="doc">VAE-based Counterfactuals (Pytorch only)</span></a>.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nb_index.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="DiCE_feature_importances.html" class="btn btn-neutral float-right" title="Estimating local and global feature importance scores using DiCE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Ramaravind, Amit, Chenhao.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>